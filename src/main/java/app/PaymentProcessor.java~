package app;

import java.util.Random;
import java.util.Scanner;

public class PaymentProcessor {
      public boolean procesarPago(Pedido pedido) {
        Scanner scanner = new Scanner(System.in);

        System.out.println("ğŸ’° Total a pagar: \u001B[32m$" + pedido.getTotal() + "\u001B[0m");
        System.out.println("Seleccione mÃ©todo de pago:");
        System.out.println("1. Tarjeta de crÃ©dito");
        System.out.println("2. Efectivo");
        System.out.println("3. CÃ³digo promocional");
        System.out.print("OpciÃ³n: ");
        int metodo = Integer.parseInt(scanner.nextLine());

        switch (metodo) {
            case 1 -> {
                System.out.print("Ingrese nÃºmero de tarjeta (16 dÃ­gitos): ");
                String tarjeta = scanner.nextLine();
                if (!tarjeta.matches("\\d{16}")) {
                    System.out.println("âŒ Tarjeta invÃ¡lida.");
                    return false;
                }
                System.out.print("Ingrese cÃ³digo de seguridad (CVV): ");
                String cvv = scanner.nextLine();
                if (!cvv.matches("\\d{3}")) {
                    System.out.println("âŒ CVV invÃ¡lido.");
                    return false;
                }
                System.out.print("Confirmar pago con tarjeta (s/n): ");
                String confirmar = scanner.nextLine();
                if (!confirmar.equalsIgnoreCase("s")) return false;
                System.out.println("ğŸ’³ Procesando pago...");
                // SimulaciÃ³n de validaciÃ³n...
                esperar();
                return true;
            }
            case 2 -> {
                System.out.print("Â¿Confirmas que pagarÃ¡s en efectivo al recibir? (s/n): ");
                String confirmar = scanner.nextLine();
                if (!confirmar.equalsIgnoreCase("s")) return false;
                System.out.println("ğŸ§¾ Pedido marcado para pago en efectivo.");
                return true;
            }
            case 3 -> {

                if (jugarMiniJuegoPromocional(scanner)) {
                    System.out.println("ğŸ‰ Â¡CÃ³digo desbloqueado! Se aplicarÃ¡ el descuento.");
                   
                    return true;
                } else {
                    System.out.println("âŒ No lograste desbloquear el cÃ³digo promocional.");
                    return false;
                }
            }
            default -> {
                System.out.println("âŒ MÃ©todo invÃ¡lido.");
                return false;
            }
        }
    }

    private boolean jugarMiniJuegoPromocional(Scanner scanner) {
        Random random = new Random();
        int numeroSecreto = random.nextInt(5) + 1; // NÃºmero entre 1 y 5
        int intentos = 3;

        System.out.println("ğŸ” Â¡Bienvenido al mini juego promocional!");
        System.out.println("Adivina el nÃºmero secreto (entre 1 y 5) en " + intentos + " intentos.");
        for (int i = 1; i <= intentos; i++) {
            System.out.print("Intento " + i + " - Tu respuesta: ");
            int respuesta = Integer.parseInt(scanner.nextLine());
            if (respuesta == numeroSecreto) {
                System.out.println("âœ… Â¡Correcto! Has desbloqueado el cÃ³digo: \u001B[35mPIZZA50\u001B[0m");
                return true;
            } else {
                System.out.println("âŒ Incorrecto.");
            }
        }
        System.out.println("El nÃºmero secreto era: " + numeroSecreto);
        return false;
    }

    private void esperar() {
        try {
            Thread.sleep(1000);
            System.out.println("âœ… Pago exitoso.");
        } catch (InterruptedException e) {
            System.out.println("âš ï¸ Error en el sistema de pagos.");
        }
    }
}
